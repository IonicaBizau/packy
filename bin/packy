#!/usr/bin/env node

const packy = require("../lib")
    , log = require("emoji-logger")
    , abs = require("abs")
    , Clp = require("clp")
    , pack = require("../package")
    ;

const PATH = process.cwd() + "/package.json";

var parser = new Clp({
    name: "Packy"
  , version: pack.version
  , exe: pack.name
  , examples: [
        "packy"
    ]
  , docs_url: pack.homepage
  , notes: "Make sure the config file is available at ~/.packy.js or ~/pack.json."
  , process: true
});

try {
    var def = require(abs("~/.packy"));
} catch (e) {
    if (e.code === "MODULE_NOT_FOUND") {
        return log("Cannot find ~/.packy.js or ~/.packy.json. Create one of these files to store the defaults.", "warn");
    }
    return log(e.message, "error");
}

packy(PATH, def, (err, data) => {
    if (err) { return log(err.message, "error"); }
    log("Done.");
});
